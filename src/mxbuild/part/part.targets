<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  
  <PropertyGroup>
    <ResolveMetaReferencesDependsOn>
      _ResolvePartProjectReferences;
      $(ResolveMetaReferencesDependsOn);
    </ResolveMetaReferencesDependsOn>
  </PropertyGroup>

  <!--_ResolvePartProjectReferences-->
  <Target 
    Name="_ResolvePartProjectReferences"
    Condition="
      '$(IsCompositePlatform)'=='true' AND
      '$(SkipPartBuild)'!='true' AND
      '$(BuildTarget)'!='Compile' AND
      '$(BuildTarget)'!='GetTargetPath'
    "
  >
    <!--MetaReference-->
    <ItemGroup>
      
      <!--IsCompositePlatform -> MetaReference-->
      <MetaReference Include="$(ProjFile)" >
        <ReferenceSource>PartReference</ReferenceSource>
        <Platform>part</Platform>
        <AdditionalProperties>$(KeepRecursiveFrame)_IsPartPlatform=true</AdditionalProperties>
        <Name>$(AssemblyName)</Name>
        <ExcludeFromTargetResult>true</ExcludeFromTargetResult>
      </MetaReference>
    </ItemGroup>
  </Target>
  
</Project>